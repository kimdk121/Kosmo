<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.staff.erp.service.StaffMapper">

	<select id="retrieveList" resultType="HashMap">
		/*
		StafftMapper.retrieveList
		목록 조회
		*/
		select 
			cast(A.staff_no as char(4)) "staff_no"
			,A.staff_name "staff_name"
			,CASE SUBSTR(A.JUMIN_NO,8,1) WHEN '1' THEN '남' WHEN  '2' THEN '여' END "gender"
			,B.religion_name "religion_name"
			,A.graduate_day "graduate_day"
		from 
			staff A left join code_religion B on A.religion_code = B.religion_code 
	</select>
	
	<select id="selectStaffNo" resultType="int">
		select 
			staff_no 
		from 
			staff 
		where 
			jumin_no = concat(#{jumin_no1},'-',#{jumin_no2})
	
	</select>
	
	<select id="retrieve" resultType="HashMap">
		select
			staff_no
			,staff_name
			,jumin_no
			,religion_code
			,school_code 
			,graduate_day
		from
			staff
		where
			staff_no = ${staff_no}
	</select>
	
	<select id="retrieveSkill" resultType="int">
		select
			skill_code
		from
			staff_skill
		where
			staff_no = ${staff_no}
	</select>
	
	<select id="ajaxSearchList">
		select
			cast(A.staff_no as char(4)) "staff_no"
			,A.staff_name "staff_name"
			,CASE SUBSTR(A.JUMIN_NO,8,1) WHEN '1' THEN '남' WHEN  '2' THEN '여' END "gender"
			,B.religion_name "religion_name"
			,A.graduate_day "graduate_day"
		from
			staff A left join code_religion B on A.religion_code = B.religion_code 
		where 
			A.staff_name like '%#{staff_name}%'
			and A.jumin_no like case #{gender} when '1' then '%-1%' when '2' then '%-2%' else '%-%' end 
			and A.religion_code like case when #{religion_code} in('1','2','3','4','5') then '3' else '_' end 
			and A.school_code like case when #{school_code} in('1','2','3') then '3' else '_' end 
			and B.skill_code = <foreach collection="list" item="item" separator="or">
								 #{skill_codeList}
								</foreach>
			and A.graduate_day between concat(#{graduate_year_1},'-',#{graduate_month_1},'-',#{graduate_day_1}) and concat(#{graduate_year_2},'-',#{graduate_month_2},'-',#{graduate_day_2})
		group by 
			A.staff_no 
	
			
			
	</select>
	
	<insert id="insertStaff">
		insert into staff 
		(
			staff_no
			,staff_name
			,jumin_no
			,school_code 
			,religion_code
			,graduate_day
		) values (
			(select ifnull(max(a.staff_no), 0)+1 from staff a)
			,#{staff_name}
			,concat(#{jumin_no1},'-',#{jumin_no2})
			,#{school_code}
			,#{religion_code}
			,concat(#{graduate_year},'-',#{graduate_month},'-',#{graduate_day})
		)
	</insert>
	
	<update id="updateStaff">
		update
			staff
		set
			staff_name = #{staff_name}
			,jumin_no = concat(#{jumin_no1},'-',#{jumin_no2})
			,school_code = #{school_code}
			,religion_code = #{religion_code}
			,graduate_day = concat(#{graduate_year},'-',#{graduate_month},'-',#{graduate_day})
		where
			staff_no = ${staff_no}
	</update>
	
	<insert id="insertSkill">
		insert into staff_skill
		(
			staff_no
			,skill_code
		) values (
			cast(#{staff_no} as unsigned)
			,#{skill_code}
		)
	</insert>
	
	<delete id="deleteStaffSkillAll">
		delete
		from
			staff_skill 
		where staff_no = ${staff_no}
	</delete>
	
	
</mapper>